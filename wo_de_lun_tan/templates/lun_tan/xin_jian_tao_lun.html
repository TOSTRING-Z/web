{% extends "public.html" %}
{% block title %}
    M站_萌咔萌咔弹幕视频网_干净的动漫网站(´っω･｀｡):新建讨论
{% endblock %}
{% block keywords %}M站,动漫,二次元,萌咔,萌咔萌咔,萌咔by,弹幕{% endblock %}
{% block description %}萌咔萌咔,简称M站( ,,´･ω･)ﾉ(´っω･｀｡)建立本网站,为二次元大家建立一个干净,舒适的╮(╯▽╰)╭ 补番环境。本网站设置最多6个播放源,应该不容易挂完吧( ๑´•ω•) (ㆆᴗㆆ){% endblock %}
{% block index %}{{ 'active' }}{% endblock %}
{% block container %}
{% block css %}
    <link href="{{ url_for( 'static',filename='public/summernote/summernote-bs4.css') }}" rel="stylesheet"/>
    <style>
        .note-editor.note-frame {
            border: 1px solid #f0f0f0;
            border-radius: 0 0 3px 3px;
        }
        textarea.form-control {
            border: 1px solid #f0f0f0;
            font-size: 28px;
            line-height: 1;
            height: calc(2.25rem + 2px);
            border-radius: 3px 3px 0 0;
        }
        .note-popover .popover-content, .card-header.note-toolbar {
            margin: 0;
            background: #ffffff;
        }
        .btn-close {
            position: absolute;
            right: 25px;
            bottom: 35px;
            z-index: 50;
        }
    </style>
{% endblock %}
    {#讨论交流#}
    <br>
    <div class="card">
        <div class="card-body">
            <div class="row">
                <form class="col-lg-12" role="form" id="forms" method="post" action="/xin_jian_tao_lun/{{ plate_id }}">
                    <div class="row" style="background-color: #ffffff;padding: 0 15px;">
                        <input type="text" name="imgName" id="imgName" style="display: none">
                        <textarea type="text" required onchange="javascript:if(this.value.length>50)this.value=this.value.slice(0,50);this.style.height = 'auto';this.style.height = this.scrollHeight +1+ 'px'" oninput="javascript:if(this.value.length>50)this.value=this.value.slice(0,50);this.style.height = 'auto';this.style.height = this.scrollHeight +1+ 'px'" class="form-control col-lg-9 col-12" rows="1" placeholder="请输入标题（最多 50 个字）" id="Title" name="title"></textarea>
                        <select required style="border-color: #f6f6f6" type="text" class="form-control col-lg-3 col-12" id="Type" name="type">
                        {% for types in classification %}
                        <option value="{{ types.type }}">{{ types.type_name }}</option>
                        {% endfor %}
                        </select>
                    </div>
                    <input id="Subtitle" type="text" name="subtitle" style="display: none">
                </form>
                <div class="col-lg-12">
                   <div id="summernote"></div>
                    <button type="button" id="submit" class="btn btn-primary">提交</button>
                </div>

            </div>
        </div>
    </div>
    <br>
    {#讨论交流结束#}

{% endblock %}
{% block public %}
    <script type="text/javascript" src="{{ url_for( 'static',filename='public/summernote/summernote-bs4.js') }}"></script>
    <script>
        var imgName = "";
        // 初始化插件
        $(function () {
            $("#summernote").summernote();
        });
        var $summernote = $("#summernote");
        $summernote.summernote({
            placeholder: '请输入内容',
            tabsize: 1,
            // 高度与焦点
            height:200,
            // 对话框显示在body而非summernote
            dialogsInBody: true,
            dialogsFade:true,
            // 图片上传
            callbacks: {
                onImageUpload: function(files) {
                    sendFile(files[0]);
                }
            }

        });
        function sendFile(file) {
            data = new FormData();
            data.append("file", file);
            $.ajax({
                data: data,
                type: "POST",
                url: "/uploadMain",
                cache: false,
                contentType: false,
                processData: false,
                success: function(url) {
                    console.log(url);
                    $summernote.summernote('insertImage',url);
                    imgName = imgName+"|"+url;
                    document.getElementById("imgName").value = imgName;
                },
                error:function () {
                    alert("上传失败");
                }
            });
        }
        $("#submit").click(function () {
            var type = document.getElementById("Type").value;
            var title = document.getElementById("Title").value;
            var Type = document.getElementById("Type").value;
            var subtitle = $('#summernote').summernote('code');
            $("#Subtitle").attr("value",subtitle);
            if (title!=""&&subtitle!=""&&Type!=""){
               document.getElementById("forms").submit();
            }
        });
        document.getElementById("Type").value = "{{ sel }}";
    </script>
{% endblock %}